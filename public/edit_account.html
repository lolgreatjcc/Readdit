<!--Tan Yong Rui DIT/FT/2B/03 P2004147-->
<!DOCTYPE html>

<head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href = "css/edit_form.css">

        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="./includeHTMLs/head.js"></script>
    <script src="./includeHTMLs/header.js"></script>

    <script>

    function loadaUserInfo() {
    var {user_id} = JSON.parse(localStorage.getItem("userInfo"))
    var token = localStorage.getItem("token")
// call the web service endpoint
    $.ajax({
        url: `http://localhost:3000/users/` + user_id,
        type: 'GET',
        //data: data2,
        contentType: "application/json; charset=utf-8",
        dataType: 'json',
        headers: {
            "authorization" : `Bearer ${token}`},
        success: function (data, textStatus, xhr) {
            $('#users').html("");
            // if (data != null && data.success) {
            //     //$('#msg').html('Record updated successfully!');
            // } else {
            //     console.log("Error");
            data = data.Result;
            console.log("data: " + data)
                var user = data;
                // compile the data that the card needs for it's creation
               
            document.getElementById("username").value = user.username;
            document.getElementById("email").value = user.email;
            $('#loadingText').html("");
            //     console.log(textStatus)
            //     console.log(xhr)

            // }
        },

            
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
                console.log(xhr);
                console.log(textStatus);
                console.log(errorThrown);
                $('#loadingText').html("<h6 class='text-danger'>ERROR LOADING!</h6>");
            if (xhr.status == 403) {
                $('#msg').html('F̵̤̈ò̵̬r̶͙̃b̴͖͛i̶̲͒d̸̞̓d̵̮́e̷̬̐n̵̻̄');
            }
        }
    });
};

        $(document).ready(function () {
            loadaUserInfo();
            $("#Submit").click(function () {
                // data extraction
                var email = $('#email').val();
                var oldpwd = $('#oldpwd').val();
                var newpwd = $('#newpwd').val();
                var username = $('#username').val();
                var {user_id} = JSON.parse(localStorage.getItem("userInfo"));
                var token = localStorage.getItem("token");    

                // data compilation
                var data = {username:username,email:email,oldpwd:oldpwd,newpwd:newpwd}
                //  call web service endpoint
                $.ajax({
                    // url: 'https://readdit-backend.herokuapp.com/api/login',
                    url: `http://localhost:3000/users/` + user_id,
                    type: 'PUT',
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    headers: {"authorization" : `Bearer ${token}`},
                    success: function (data, textStatus, xhr) {
                        console.log("Running ajax")
                        if (data != null) {
                            console.log(data)
                            $(`#messages`).html("Change successful");
                        } else {
                            console.log("Error");
                          }
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        console.log("Xhr: " + xhr);
                        console.log("textStatus: " + textStatus);
                        console.log("errorThrown: " + errorThrown);
                        console.log('Error in Operation');
                        
                        $(`#messages`).html("Change unsuccessful");
                    }
                });
                return false;
            });
        })
    </script>
</head>

<body>
    <div id="edit_form_container" class="login-form">
        <h1 class="text-center">Edit Account</h1>
        <form id="edit_form" class="justify-content-center" action="">
            <div class="form-group">
                <label for="username">Username:</label><br>
                <input type="text" id="username" class="form-control" name="username" placeholder="Username" required="required"><br>
            </div>
            <div class="form-group">
                <label for="email">Email:</label><br>
                <input type="text" id="email" class="form-control" name="email" placeholder="Email" required="required"><br>
            </div>
            <div class="form-group">
                <label for="newpwd">New Password (Optional):</label><br>
                <input type="password" id="newpwd" class="form-control" name="newpwd" placeholder="New Password (Optional)"><br>
            </div>       
            <div class="form-group">
                <label for="oldpwd">Enter Old Password To Save Changes:</label><br>
                <input type="password" id="oldpwd" class="form-control" name="oldpwd" placeholder="Old Password" required="required"><br><br>
            </div>     
            <button type="button" class="btn btn-primary btn-block" id="Submit">Submit</button>
            <div id="messages"></div>
        </form>

    </div>
</body>

</html>