<!--
Class: DIT/FT/1B/03
Name: Tan Yong Rui
Admission Number: P2004147
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="./css/login.css">
    <link rel="stylesheet" href="./css/general.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="css/login.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>

    <title>Software Smith</title>
</head>

<script>
    function loggedIn(){
            if (localStorage.getItem('token') != null){
                window.location.assign("https://tyrgames.herokuapp.com/home.html");
            }
            else{
                var stuff = `<li class="nav-item">
                <a class="nav-link" href="./login.html">Login</a>
            </li>`
                $('.navbar-nav').append(stuff);
            }
        }
    $(document).ready(function () {
        loggedIn();
        $("#Login").click(function () {
            // data extraction
            var id = $('#email').val();
            var pwd = $('#pwd').val();

            // data compilation
            var data = "{\"email\":\"" + id + "\", \"password\":\"" + pwd + "\"}";
            console.log(data);

            // call web service endpoint
            $.ajax({
                url: 'https://testapibackend.herokuapp.com/users/login',
                type: 'POST',
                data: data,
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data, textStatus, xhr) {
                    // -------------|
                    // |
                    // |-- contains the entire response as seen in Postman

                    if (data != null) {
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('userInfo', data.UserData);
                        window.location.assign("https://tyrgames.herokuapp.com/home.html");
                    } else {
                        console.log("Error");
                    }
                },
                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error in Operation');
                    if (xhr.status == 404){
                        alert("Invalid Credentials.")
                    }
                }
            });
            return false;
        });
    });  
</script>

<body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark sticky-top">
        <!-- Brand/logo -->
        <a class="navbar-brand" href="#">SP Games+</a>
        
        <!-- Links -->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="./home.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./games.html">Games</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./about.html">About Us</a>
        </li>
        </ul>
      </nav>
    <h1 class="header bg-info">Login</h1>
   <div class = "jumbotron">
        <div class="login-form">
            <form action="">
                <h2 class="text-center">Log in</h2>
                <div class="form-group">
                    <input type="text" class="form-control" id="email" placeholder="Username" required="required">
                </div>
                <div class="form-group">
                    <input type="password" class="form-control" id="pwd" placeholder="Password" required="required">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block" id="Login">Log in</button>
                </div>
            </form>
    
        </div>
   </div>
<!-- Background image reference -->
<section class="p-2 bg-secondary text-light">
    Background pattern obtained from <a href="https://www.toptal.com/designers/subtlepatterns/congruent-pentagon/"
        target="_blank">here</a>.
</section>

<!-- Footer -->
<footer class="darkbrown p-2 text-center text-light"><em>SP Games+</em> &#9702; Dover Link 74 &#9702; Singapore 735462</footer>
</body>

</html>