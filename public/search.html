<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="../includeHTMLs/head.js"></script>
    <script src="../includeHTMLs/header.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">


    <title>Community</title>
</head>

<body>
    <div class="container-xxl">
        <div class="row">


            <div class="col-1">
                start
            </div>
            <div class="col-11">
                end
            </div>
        </div>
    </div>
    <div class="container-xxl my-md-4">
        <div class="row">
            <div class="col-lg-1"></div>
            <div class="col-lg-10">
                <div class="w3-bar w3-black">
                    <button class="w3-bar-item w3-button tablink tabColour" onclick="switchTab(event,'subreaddits')">Subreaddits</button>
                    <button class="w3-bar-item w3-button tablink" onclick="switchTab(event,'posts')">Posts</button>
                  </div>
                  
                  <div id="subreaddits" class="w3-container w3-border tab">
                    
                  </div>
                
                  <div id="posts" class="w3-container w3-border tab" style="display:none">
                    
                  </div>
                
                </div>
            </div>
            <div class="col-lg-1"></div>
        </div>
    </div>

    
    

    
    
    <script>
    function switchTab(evt, tabName) {
      var i, x, tablinks;
      x = document.getElementsByClassName("tab");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablink");
      for (i = 0; i < x.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" tabColour", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " tabColour";
    }
    </script>

    <script>
        $(document).ready(function () {
            searchSubreaddits();
            searchPosts();
        })

        function searchSubreaddits(){
            var query = window.location.search;
            console.log(query)
            $.ajax({
                url: `http://localhost:3000/r/search/query` + query,
                method: 'GET',
                contentType: "application/json; charset=utf-8",
                success: function (data, status, xhr) {
                    var subreaddits = data.Result;
                    console.log(subreaddits)
                    for (var i=0;i<subreaddits.length;i++){
                        console.log(i)
                        $("#subreaddits").append(`
                            <div class="post rounded">
                                <div class="row g-0">
                                    <div class="col-12 bg-white p-2">
                                        <div class="d-flex flex-row align-items-baseline">
                                            <a href="/r/${subreaddits[i].subreaddit_name}"><h6 class="d-inline fw-bold clickable-link">r/${subreaddits[i].subreaddit_name}</h6></a>
                                            <p class="fw-light text-secondary mx-1">•</p>
                                            <p class="fw-light text-secondary mx-1">•</p>
                                        </div>

                                        <h5>${subreaddits[i].subreaddit_description}</h5>
                                    </div>
                                </div>
                            </div>
                            `)
                    }
                 
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error)
                }
            })
        }

        function searchPosts(){
            var query = window.location.search;
            console.log(query)
            $.ajax({
                url: `http://localhost:3000/post/search` + query,
                method: 'GET',
                contentType: "application/json; charset=utf-8",
                success: function (data, status, xhr) {
                    var posts = data.Result;
                    console.log(posts)
                    for (var i=0;i<posts.length;i++){
                        console.log(i)
                        $("#posts").append(`
                            <div class="post rounded">
                                <div class="row g-0">
                                    <div class="col-12 bg-white p-2">
                                        <div class="d-flex flex-row align-items-baseline">
                                            <a href="/r/${posts[i].Subreaddit.subreaddit_name}/${posts[i].post_id}"><h6 class="d-inline fw-bold clickable-link">${posts[i].title}</h6></a>
                                            <p class="fw-light text-secondary mx-1">•</p>
                                            <p class="fw-light text-secondary mx-1">•</p>
                                        </div>

                                        <h5>${posts[i].content}</h5>
                                    </div>
                                </div>
                            </div>
                            `)
                    }
                 
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error)
                }
            })
        }


    </script>
</body>

</html>